<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="frmMain.css">
    <link rel="stylesheet" type="text/css" href="./plugins/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="./plugins/jquery-ui.structure.min.css">
    <link rel="stylesheet" type="text/css" href="./plugins/jquery-ui.theme.min.css">

    <!-- Include jQuery -->
    <script>
        window.$ = window.jQuery = require("jquery");
    </script>
    <script src="./plugins/jquery-ui.js"></script>
    <!-------------------->
    <!-- UDP Code -------->
    <script src="./udp.js" type="text/javascript"></script>
    <!-------------------->
    <script>

        var gv_phone_data = [];
        function write_to_phone(ln, io, se, dur, cs, rings, date, time, num, name, clear_as_bool)
        {
            if(clear_as_bool)
            {
                gv_phone_data = [];
            }
            else
            {
                var template_text = `
                <table id="gv_phone_row_id_xxx" class="grid_row_phone">
                    <tr>
                    <td style="width:54px;">Ln</td>
                    <td style="width:63px;">IO</td>
                    <td style="width:60px;">SE</td>
                    <td style="width:77px;">Dur</td>
                    <td style="width:61px;">CS</td>
                    <td style="width:64px;">Rings</td>
                    <td style="width:48px;">Date</td>
                    <td style="width:98px;">Time</td>
                    <td style="text-align:center;width: 192px;">Number</td>
                    <td style="text-align:center;border-right:none;width: 205px;">Name</td>
                    </tr>
                </table>
                `;

                template_text = template_text.replace("Ln", ln);
                template_text = template_text.replace("IO", io);
                template_text = template_text.replace("SE", se);
                template_text = template_text.replace("Dur", dur);
                template_text = template_text.replace("CS", cs);
                template_text = template_text.replace("Rings", rings);
                template_text = template_text.replace("Date", date);
                template_text = template_text.replace("Time", time);
                template_text = template_text.replace("Number", num);
                template_text = template_text.replace("Name", name);

                gv_phone_data.push(template_text);
            }

            update_phone_data();
        }

        function update_phone_data()
        {
            var all_rows = "";
            var cnt = 1;
            gv_phone_data.forEach(function(row){
                all_rows += row.replace("gv_phone_row_id_xxx", "gv_phone_row_id_" + cnt);
                cnt++;
            });

            $("#gv_phone_data").html(all_rows);

            cnt--;
            var rowpos = $('#gv_phone_row_id_' + cnt).position();
            $('#gv_phone_data').scrollTop(rowpos.top);

        }

        var gv_comm_data = [];
        function write_to_comm(str, clear_as_bool)
        {
            if(clear_as_bool)
            {
                gv_comm_data = [];
                last_v_command_reception = "";
            }
            else
            {
                var row = "<tr><td>" + str + "</td></tr>";
                gv_comm_data.push(row);
            }
            update_comm_data();
        }

        function update_comm_data()
        {
            var all_rows = "";

            gv_comm_data.forEach(function(row){
                all_rows += row;
            });

            $("#gv_comm_data").html(all_rows);

            var rowpos = $('#table_comm tr:last').position();
            $('#gv_comm_data').scrollTop(rowpos.top);
        }

        $(document).ready(function(){
            
            write_to_comm("", true);

            // --------------------------------------------------------
            // Check bound status
            // Update status below
            var dialog_bind_warning_3520 = $("#bind_warning_3520").dialog({
                    autoOpen: false,
                    show: {
                        effect: "blind",
                        duration: 500
                    },
                    hide: {
                        effect: "fade",
                        duration: 500
                    },
                    buttons: {
                        "Close": function() {
                        $( this ).dialog( "close" );
                        }
                    }
            });

            var dialog_bind_warning_6699 = $("#bind_warning_6699").dialog({
                    autoOpen: false,
                    show: {
                        effect: "blind",
                        duration: 500
                    },
                    hide: {
                        effect: "fade",
                        duration: 500
                    },
                    buttons: {
                        "Close": function() {
                        $( this ).dialog( "close" );
                        }
                    }
            });

            var dialog_bind_warning_3520_6699 = $("#bind_warning_3520_6699").dialog({
                    autoOpen: false,
                    show: {
                        effect: "blind",
                        duration: 500
                    },
                    hide: {
                        effect: "fade",
                        duration: 500
                    },
                    buttons: {
                        "Close": function() {
                        $( this ).dialog( "close" );
                        }
                    }
            });

            if(get_bound_status(3520) && get_bound_status(6699))
            {
                $('#lbBoundTo').text("Bound: 3520 & 6699");
            }
            else if(!get_bound_status(3520) && get_bound_status(6699))
            {
                $('#lbBoundTo').text("Bound: 6699");
                dialog_bind_warning_3520.dialog('open');
            }
            else if(get_bound_status(3520) && !get_bound_status(6699))
            {
                $('#lbBoundTo').text("Bound: 3520");
                dialog_bind_warning_6699.dialog('open');
            }
            else
            {
                $('#lbBoundTo').text("Bound: Failed");
                dialog_bind_warning_3520_6699.dialog('open');
            }

            // --------------------------------------------------------

            let info_content_main = `
                This configuration and test tool is normally for:<br/>
                <ul>
                    <li>Setting the static IP of the device</li>
                    <li>Testing for call records arriving from the Caller ID unit</li>
                </ul>
                Advanced users can set a number of other parameters including:<br/>
                <ul>
                    <li>Toggles for output options on Deluxe units</li>
                    <li>Destination IP and MAC unicasts</li>
                    <li>Duplicate call record delivery to increase throughput</li>
                    <li>Starting Line count when connecting multiple units</li>
                </ul>
            `;

            let info_content_unit_number = `
                Some applications use unit numbers to match data arriving from multiple units.
            `;

            let info_content_unit_ip = `
                Set a static IP address within the IP scheme either outside the DHCP range or a value that would not create an IP conflict with another device on the network.<br/><br/>Based on this computerâ€™s IP address of: [computer_ip] the suggested IP of the unit should be: [suggested_ip].
            `;

            let info_content_dest_port = `
                The default Network communication port is 3520. Do not change unless your application absolutely requires it. A value other than 3520 or 6699 will require you change the listening port on this application.
            `;

            let info_content_dest_ip = `
                The IP to where the call records will be sent. The default is 255.255.255.255 (broadcast) which most applications use, even if only one PC is listening for data. Change only if necessary.
            `;

            let info_content_dest_mac = `
                The MAC address to where call records will be sent. The default is FF-FF-FF-FF-FF-FF (Broadcast) which most applications use. Change to specific MAC only if the Destination IP is specified as a unicast.
            `;

            $('#lbInfoTitle').text('ELConfig:');
            $('#lbInfoContent').html(info_content_main);

            $('#btnChangeUnitNumber').hover(
                
                // Hover
                function(){
                    $('#lbInfoTitle').text('Unit Number:');
                    $('#lbInfoContent').html(info_content_unit_number);
                },

                // Exit
                function(){
                    $('#lbInfoTitle').text('ELConfig:');
                    $('#lbInfoContent').html(info_content_main);
             });

             $('#btnSuggestIP').hover(
                
                // Hover
                function(){
                    $('#lbInfoTitle').text('Unit IP Address:');
                    $('#lbInfoContent').html(info_content_unit_ip);
                },

                // Exit
                function(){
                    $('#lbInfoTitle').text('ELConfig:');
                    $('#lbInfoContent').html(info_content_main);
            });

            $('#btnChangeDestPort').hover(
                
                // Hover
                function(){
                    $('#lbInfoTitle').text('Unit Destination Port:');
                    $('#lbInfoContent').html(info_content_dest_port);
                },

                // Exit
                function(){
                    $('#lbInfoTitle').text('ELConfig:');
                    $('#lbInfoContent').html(info_content_main);
            });

            $('#btnChangeDestIP').hover(
                
                // Hover
                function(){
                    $('#lbInfoTitle').text('Destination IP Address:');
                    $('#lbInfoContent').html(info_content_dest_ip);
                },

                // Exit
                function(){
                    $('#lbInfoTitle').text('ELConfig:');
                    $('#lbInfoContent').html(info_content_main);
            });

            $('#btnChangeDestMAC').hover(
                
                // Hover
                function(){
                    $('#lbInfoTitle').text('Unit MAC Address:');
                    $('#lbInfoContent').html(info_content_dest_mac);
                },

                // Exit
                function(){
                    $('#lbInfoTitle').text('ELConfig:');
                    $('#lbInfoContent').html(info_content_main);
            });

            // --------------------------------------------------------

            $('#btnGetToggles').on('click', function(){

                get_toggles();

            });

            $('#btnToggleC').on('click', function(){

                set_toggle($('#btnToggleC').val());

            });

            $('#btnToggleU').on('click', function(){

                set_toggle($('#btnToggleU').val());

            });

            $('#btnToggleD').on('click', function(){

                set_toggle($('#btnToggleD').val());

            });

            $('#btnToggleA').on('click', function(){

                set_toggle($('#btnToggleA').val());

            });

            $('#btnToggleS').on('click', function(){

                set_toggle($('#btnToggleS').val());

            });

            $('#btnToggleO').on('click', function(){

                set_toggle($('#btnToggleO').val());

            });

            $('#btnToggleB').on('click', function(){

                set_toggle($('#btnToggleB').val());

            });

            $('#btnToggleK').on('click', function(){

                set_toggle($('#btnToggleK').val());

            });

            $('#btnV').on('click', function(){
                // v Command
            });

            $('#btnClearCommData').on('click', function(){

                write_to_comm("", true);

            });

            $('#btnClearPhoneData').on('click', function(){
                write_to_phone("", "", "", "", "", "", "", "", "", "", true);
            });

        });

    </script>

    </head>
  <body>
      
    <div class="header_row">
        <div class="top_header">
            <table>
                <tr>
                    <td style="width: 180px;">
                        Starting Line Count = <span class="custom_label" id="lbLineCount">01</span>
                    </td>
                    <td style="width: 140px;">
                        # Of Dups: <span class="custom_label" id="lbDups">1</span>
                    </td>
                    <td>
                        <label for="ckbIgnoreDups">
                            <input type="checkbox" id="ckbIgnoreDups" checked="true"/>Ignore Dups
                        </label>
                    </td>
                </tr>
            </table>
            
        </div>
    </div>
    
    <table style="width: 100%;">

        <tr>
            <td>
            
                <table class="edit_settings">

                    <tr>
                        <td style="width:200px;">
                            <p align="right"><b>Unit Number: </b></p>
                        </td>
                        <td style="width:100px;">
                            <input type="text" id="tbUnitNumber" maxlength="6" class="custom_input"/><br/>
                        </td>
                        <td style="width:100px;">
                            <input type="button" width="80px" id="btnChangeUnitNumber" value="Change"/><br/>
                        </td>
                    </tr>
            
                    <tr>
                        <td>
                            <p align="right"><b>Unit IP: </b></p>
                        </td>
                        <td>
                            
                            <div class="input_ip">

                                <input type="text" maxlength="3" id="tbUnitIP_1"/> .
                                <input type="text" maxlength="3" id="tbUnitIP_2"/> .
                                <input type="text" maxlength="3" id="tbUnitIP_3"/> .
                                <input type="text" maxlength="3" id="tbUnitIP_4"/>
                            
                            </div>

                        </td>
                        <td style="width:100px;">
                            <input type="button" width="80px" id="btnSuggestIP" value="Set IP to Suggested"/><br/>
                        </td>
                    </tr>
            
                    <tr>
                        <td>
                            <p align="right"><b>Unit MAC Address: </b></p>
                        </td>
                        <td>
                            
                            <div class="input_mac">

                                <input type="text" id="tbUnitMAC_1"/> -
                                <input type="text" id="tbUnitMAC_2"/> -
                                <input type="text" id="tbUnitMAC_3"/> -
                                <input type="text" id="tbUnitMAC_4"/> -
                                <input type="text" id="tbUnitMAC_5"/> -
                                <input type="text" id="tbUnitMAC_6"/>
                            
                            </div>

                        </td>
                    </tr>
            
                    <tr>
                        <td>
                            <p align="right"><b>Destination Port: </b></p>
                        </td>
                        <td>
                            <input type="text" id="tbDestPort" class="custom_input"/><br/>
                        </td>
                        <td style="width:100px;">
                            <input type="button" width="80px" id="btnChangeDestPort" value="Change"/><br/>
                        </td>
                    </tr>
            
                    <tr>
                        <td>
                            <p align="right"><b>Destination IP Address: </b></p>
                        </td>
                        <td>
                            
                            <div class="input_ip">

                                <input type="text" maxlength="3" id="tbDestIP_1"/> .
                                <input type="text" maxlength="3" id="tbDestIP_2"/> .
                                <input type="text" maxlength="3" id="tbDestIP_3"/> .
                                <input type="text" maxlength="3" id="tbDestIP_4"/>
                            
                            </div>

                        </td>
                        <td style="width:100px;">
                            <input type="button" width="80px" id="btnChangeDestIP" value="Change"/><br/>
                        </td>
                    </tr>
            
                    <tr>
                        <td>
                            <p align="right"><b>Destination MAC Address: </b></p>
                        </td>
                        <td>
                            
                            <div class="input_mac">

                                <input type="text" id="tbDestMAC_1"/> -
                                <input type="text" id="tbDestMAC_2"/> -
                                <input type="text" id="tbDestMAC_3"/> -
                                <input type="text" id="tbDestMAC_4"/> -
                                <input type="text" id="tbDestMAC_5"/> -
                                <input type="text" id="tbDestMAC_6"/>
                            
                            </div>

                        </td>
                        <td style="width:100px;">
                            <input type="button" width="80px" id="btnChangeDestMAC" value="Change"/><br/>
                        </td>
                    </tr>

                </table>
                
            </td>

            <td class="info_area">
                <div id="lbInfoTitle" class="custom_label">ELConfig 5:</div>
                <p></p><span id="lbInfoContent">
                    <!-- Content for info area -->
                </span></p>
            </td>
        </tr>

    </table>

    <table style="padding-left: 5px; width: 100%;">

        <tr>

            <td style="width: 300px;">
                Communication Data &nbsp;<input type="button" id="btnClearCommData" value="Clear"/>
            </td>

            <!-- Locked commands -->

            <td style="width: 300px;">
                <input type="button" id="btnV" value="v"/>
            </td>

            <!--------------------->
            
            <!-- Toggles -->
            <td>
                <input type="button"  id="btnGetToggles" value="Retrieve Toggles"/>
                <input type="button"  id="btnToggleC" value="C"/>
                <input type="button" id="btnToggleU" value="U"/>
                <input type="button" id="btnToggleD" value="D"/>
                <input type="button" id="btnToggleA" value="A"/>
                <input type="button" id="btnToggleS" value="S"/>
                <input type="button" id="btnToggleO" value="O"/>
                <input type="button" id="btnToggleB" value="B"/>
                <input type="button" id="btnToggleK" value="K"/>
            </td>

            <!------------->

        </tr>

    </table>

    <!-- Comm. Gridview -->
    <table id="table_comm" class="grid_background_comm">
        <thead><th class='grid_header'>Unit Output</th></thead>
        <tbody id="gv_comm_data" class="grid_comm">
            <!-- COMM ROWS -->
        </tbody>
    </table>

    <table style="padding-left: 5px; width: 100%;">
        <tr>
            <td>
                Phone Data &nbsp;<input type="button" id="btnClearPhoneData" value="Clear"/>
            </td>
        </tr>
    </table>

    <!-- Phone Gridview -->
    <div class="grid_background_phone">

        <div class="grid_header_phone">
            <table>
                <tr>
                  <td style="width:40px;">Ln</td>
                  <td style="width:46px;">IO</td>
                  <td style="width:42px;">SE</td>
                  <td style="width:62px;">Dur</td>
                  <td style="width:42px;">CS</td>
                  <td style="width:42px;">Rings</td>
                  <td style="width:28px;">Date</td>
                  <td style="width:82px;">Time</td>
                  <td style="width: 192px;">Number</td>
                  <td style="border:none; width: 240px;">Name</td>
                </tr>
            </table>
        </div>
        
        <div id="gv_phone_data" class="grid_phone">
            <!-- PHONE DATA -->
        </div>
      
      </div>

    <!-- Status Bar -->
    <table id="status_bar" class="status_bar_disconnected">
        <tr>
            <td style="padding-left: 20px;">
                <img id="imgConnected" class="hidden" src="./build/connected.png" style="width: 20px; height:25px;"/>
            </td>
            <td>
                <span id="lbStatus">NOT Connected</span>
            </td>
            <td>
                <span id="lbSendingTo">Sending Commands to: 000.000.000.000</span>
            </td>
            <td>
                <span id="lbDeluxeUnit">Deluxe Unit NOT Detected</span>
            </td>
            <td>
                <span id="lbBoundTo">Bound: Failed</span>
            </td>
        </tr>
    </table>

    </body>
</html>


<!---------------------- Alerts -------------------------->
<div id="bind_warning_3520" title="Bind Warning">
    <p style="padding-top: 10px;">Bound to 6699. Failed to bind to 3520, port already in use.</p>
</div>

<div id="bind_warning_6699" title="Bind Warning">
    <p style="padding-top: 10px;">Bound to 3520. Failed to bind to 6699, port already in use.</p>
</div>

<div id="bind_warning_3520_6699" title="Bind Failure">
    <p style="padding-top: 10px;">Failed to bind to 3520 and 6699, ports already in use.</p>
</div>
<!-------------------------------------------------------->